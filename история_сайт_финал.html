<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>–§—Ä–∞–Ω—Ü–∏—Ç–æ ‚Äî –ì–ª–∞–≤–Ω–∞—è</title>
<meta content="–§—Ä–∞–Ω—Ü–∏—Ç–æ ‚Äî –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Å–∞–π—Ç: —Å—Ç–æ—Ä–∏—Å –ù–∞–ø–æ–ª–µ–æ–Ω–∞, –ø–æ—Å—Ç—ã, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ ." name="description"/>
<link href="https://images.unsplash.com" rel="preconnect"/>
<style>
  :root{
    --bg-start: #E8F8FF;
    --bg-end: #F6FBFF;
    --primary-a: #2BB6FF;
    --primary-b: #89D4FF;
    --text: #062533;
    --muted: #587388;
    --glass: rgba(255,255,255,0.42);
    --glass-2: rgba(255,255,255,0.22);
    --radius: 16px;
    --card-radius: 14px;
    --accent: #fff;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    color:var(--text);
    background: radial-gradient(1200px 400px at 10% 10%, rgba(43,150,255,0.06), transparent),
                linear-gradient(180deg,var(--bg-start),var(--bg-end));
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding-bottom:120px;
  }

  .wrap{max-width:1100px;margin:36px auto;padding:0 20px;display:flex;flex-direction:column;gap:28px}

  header{display:flex;align-items:center;gap:12px}
  .logo{
    width:56px;height:56px;border-radius:12px;
    background:conic-gradient(from 200deg,var(--primary-a),var(--primary-b));
    display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px;
    box-shadow:0 12px 30px rgba(43,150,255,0.12);
  }
  header h1{margin:0;font-size:20px}
  header p{margin:0;color:var(--muted);font-size:13px}

  .sync-controls {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-left: auto;
  }

  .sync-btn {
    background: transparent;
    border: 1px solid rgba(9,48,74,0.1);
    border-radius: 8px;
    padding: 6px 12px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .sync-btn:hover {
    background: rgba(43,182,255,0.1);
    border-color: var(--primary-a);
  }

  .sync-status {
    font-size: 11px;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .sync-status.syncing {
    color: var(--primary-a);
  }

  .hero{
    position:relative;
    border-radius:var(--radius);
    padding:28px;
    background: linear-gradient(180deg, rgba(255,255,255,0.55), rgba(255,255,255,0.3));
    box-shadow: 0 10px 30px rgba(6,26,48,0.08);
    overflow:hidden;
  }

  .hero-top{display:flex;align-items:center;justify-content:space-between;gap:18px}
  .hero-left{max-width:64%}
  .hero-left h2{margin:0;font-size:30px}
  .hero-left p{margin:8px 0 0;color:var(--muted)}
  .hero-actions{display:flex;gap:12px;margin-top:16px}
  .btn{
    border-radius:12px;padding:10px 14px;border:none;cursor:pointer;font-weight:600;
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .btn:active{transform:translateY(2px)}
  .btn-primary{
    background:linear-gradient(90deg,var(--primary-a),var(--primary-b));
    color:white;box-shadow:0 10px 30px rgba(43,150,255,0.12)
  }
  .btn-ghost{
    background:transparent;border:1px solid rgba(9,48,74,0.06);color:var(--text)
  }

  .stories{
    display:flex;gap:16px;align-items:center;margin-top:18px;
    overflow:auto;padding:12px 4px;
  }
  .story{
    min-width:90px;display:flex;flex-direction:column;align-items:center;gap:8px;
    cursor:pointer;flex-shrink:0;position:relative;
  }
  .story .avatar{
    width:78px;height:78px;border-radius:50%;padding:3px;
    background:linear-gradient(45deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4);
    display:flex;align-items:center;justify-content:center;
    transition:all 0.3s ease;
  }
  .story .avatar:hover{
    transform:scale(1.05);
    box-shadow:0 8px 25px rgba(43,150,255,0.2);
  }
  .story .avatar img{
    width:100%;height:100%;border-radius:50%;object-fit:cover;
    border:3px solid white;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  .story small{
    font-size:12px;color:var(--muted);font-weight:500;
    max-width:80px;text-align:center;line-height:1.2;
  }
  .story .delete-btn{
    position:absolute;top:-5px;right:-5px;
    background:#ff6b6b;color:white;border:none;
    width:20px;height:20px;border-radius:50%;
    font-size:12px;cursor:pointer;opacity:0;
    transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;
    box-shadow:0 2px 8px rgba(255,107,107,0.3);
  }
  .story:hover .delete-btn{opacity:1}
  .story .delete-btn:hover{
    background:#ff5252;transform:scale(1.1);
  }

  .posts{display:grid;grid-template-columns:1fr;gap:20px}
  .post{
    border-radius:var(--card-radius);
    padding:18px;
    background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(255,255,255,0.4));
    box-shadow: 0 8px 32px rgba(6,26,48,0.08);
    transition: transform .3s ease, box-shadow .3s ease;
    border:1px solid rgba(255,255,255,0.5);
    backdrop-filter:blur(10px);
    position:relative;
  }
  .post:hover{
    transform:translateY(-4px);
    box-shadow:0 12px 40px rgba(6,26,48,0.12);
  }
  .post-head{
    display:flex;gap:14px;align-items:center;
    padding-bottom:14px;border-bottom:1px solid rgba(9,48,74,0.08);
  }
  .post-head img{
    width:60px;height:60px;border-radius:14px;object-fit:cover;
    border:3px solid rgba(255,255,255,0.8);
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  .post-head .meta{display:flex;flex-direction:column;flex:1}
  .post-head .author{
    font-weight:800;font-size:16px;
    background:linear-gradient(90deg,var(--text),var(--muted));
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  }
  .post-head .time{
    font-size:13px;color:var(--muted);margin-top:2px;
    display:flex;align-items:center;gap:6px;
  }
  .post-head .time::before{
    content:"üïí";font-size:11px;
  }

  .post-body{margin-top:16px}
  .post-body .text-content{
    font-size:15px;line-height:1.5;color:var(--text);
    margin-bottom:16px;padding:0 4px;
  }
  .post-body .media-container{
    border-radius:16px;overflow:hidden;
    box-shadow:0 8px 24px rgba(0,0,0,0.1);
    position:relative;
  }
  .post-body img{
    width:100%;height:380px;object-fit:cover;display:block;
    transition:transform 0.3s ease;
  }
  .post-body video{
    width:100%;height:380px;border-radius:16px;background:#000;
    box-shadow:0 8px 24px rgba(0,0,0,0.15);
  }
  .post-body .media-container:hover img{
    transform:scale(1.02);
  }

  .post-actions{
    display:flex;gap:16px;align-items:center;margin-top:16px;
    padding-top:14px;border-top:1px solid rgba(9,48,74,0.06);
  }
  .like-btn{
    background:transparent;border:none;cursor:pointer;
    font-weight:700;color:#94a3b8;transition:all 0.3s ease;
    display:flex;align-items:center;gap:6px;padding:8px 12px;
    border-radius:10px;
  }
  .like-btn:hover{
    background:rgba(255,55,95,0.1);color:#ff375f;
    transform:translateY(-1px);
  }
  .like-btn.liked{
    color:#ff375f;
    background:rgba(255,55,95,0.1);
  }
  .likes-count{font-weight:700;font-size:14px;color:inherit}

  .comment-btn{
    background:transparent;border:none;cursor:pointer;
    font-weight:700;color:var(--muted);transition:all 0.3s ease;
    display:flex;align-items:center;gap:6px;padding:8px 12px;
    border-radius:10px;
  }
  .comment-btn:hover{
    background:rgba(43,182,255,0.1);color:var(--primary-a);
    transform:translateY(-1px);
  }

  .delete-post-btn{
    background:transparent;border:none;cursor:pointer;
    font-weight:700;color:var(--muted);transition:all 0.3s ease;
    display:flex;align-items:center;gap:6px;padding:8px 12px;
    border-radius:10px;margin-left:auto;
  }
  .delete-post-btn:hover{
    background:rgba(255,107,107,0.1);color:#ff6b6b;
    transform:translateY(-1px);
  }

  .comments{
    margin-top:16px;display:flex;flex-direction:column;gap:12px;
    background:rgba(255,255,255,0.4);padding:16px;border-radius:12px;
    border:1px solid rgba(255,255,255,0.6);
  }
  .comment{
    display:flex;gap:12px;align-items:flex-start;
    padding:12px;border-radius:10px;
    background:rgba(255,255,255,0.6);
    transition:background 0.3s ease;
  }
  .comment:hover{
    background:rgba(255,255,255,0.8);
  }
  .comment .c-avatar{
    width:40px;height:40px;border-radius:10px;overflow:hidden;flex-shrink:0;
    background:linear-gradient(135deg,var(--primary-a),var(--primary-b));
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;font-size:14px;
    box-shadow:0 4px 8px rgba(0,0,0,0.1);
  }
  .comment .c-body{
    background:transparent;padding:0;border-radius:0;flex:1;
  }
  .comment .name{
    font-weight:700;font-size:14px;
    background:linear-gradient(90deg,var(--text),var(--muted));
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  }
  .comment .text{
    font-size:14px;color:var(--text);margin-top:4px;line-height:1.4;
  }

  .add-comment{
    display:flex;gap:10px;align-items:center;margin-top:12px;
    background:white;padding:12px;border-radius:12px;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
  }
  .add-comment input{
    flex:1;padding:12px;border-radius:10px;border:1px solid rgba(9,48,74,0.1);
    background:rgba(248,250,252,0.8);font-size:14px;
    transition:all 0.3s ease;
  }
  .add-comment input:focus{
    outline:none;border-color:var(--primary-a);
    box-shadow:0 0 0 3px rgba(43,182,255,0.1);
  }
  .add-comment button{
    padding:12px 20px;border-radius:10px;border:none;
    background:linear-gradient(90deg,var(--primary-a),var(--primary-b));
    color:white;font-weight:700;font-size:14px;
    transition:all 0.3s ease;box-shadow:0 4px 12px rgba(43,182,255,0.2);
  }
  .add-comment button:hover{
    transform:translateY(-1px);box-shadow:0 6px 16px rgba(43,182,255,0.3);
  }

  .welcome-modal{
    position:fixed;inset:0;background:rgba(6,20,30,0.85);display:flex;align-items:center;justify-content:center;z-index:300;
    padding:24px;
  }
  .welcome-content{
    width:min(480px,98%);border-radius:20px;padding:32px;
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(246,253,255,0.95));
    box-shadow:0 40px 100px rgba(6,20,40,0.6);
    animation: pop .2s ease;
    border:1px solid rgba(255,255,255,0.8);
    backdrop-filter:blur(20px);
  }
  .welcome-tabs{
    display:flex;gap:0;margin-bottom:24px;border-bottom:1px solid rgba(9,48,74,0.1);
    background:rgba(255,255,255,0.5);border-radius:12px;padding:4px;
  }
  .welcome-tab{
    flex:1;padding:14px;text-align:center;background:transparent;border:none;cursor:pointer;
    font-weight:600;color:var(--muted);border-radius:8px;transition:all 0.3s ease;
  }
  .welcome-tab.active{
    color:var(--primary-a);background:white;
    box-shadow:0 4px 12px rgba(43,182,255,0.15);
  }
  .welcome-form{display:flex;flex-direction:column;gap:18px}
  .form-group{display:flex;flex-direction:column;gap:8px}
  .form-group label{font-weight:600;font-size:14px;color:var(--text)}
  .form-group input{
    padding:14px;border-radius:12px;border:1px solid rgba(9,48,74,0.1);
    background:rgba(255,255,255,0.8);font-size:15px;transition:all 0.3s ease;
  }
  .form-group input:focus{
    outline:none;border-color:var(--primary-a);
    box-shadow:0 0 0 3px rgba(43,182,255,0.1);
  }

  .profile-modal{
    position:fixed;inset:0;background:rgba(6,20,30,0.85);display:none;align-items:center;justify-content:center;z-index:300;
    padding:24px;
  }
  .profile-content{
    width:min(480px,98%);border-radius:20px;padding:32px;
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(246,253,255,0.95));
    box-shadow:0 40px 100px rgba(6,20,40,0.6);
    animation: pop .2s ease;
    border:1px solid rgba(255,255,255,0.8);
  }

  .create-modal{
    position:fixed;inset:0;background:rgba(6,20,30,0.85);display:none;align-items:center;justify-content:center;z-index:300;
    padding:24px;
  }
  .create-content{
    width:min(600px,98%);border-radius:20px;padding:32px;
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(246,253,255,0.95));
    box-shadow:0 40px 100px rgba(6,20,40,0.6);
    animation: pop .2s ease;
    border:1px solid rgba(255,255,255,0.8);
  }

  .ad-modal{
    position:fixed;inset:0;background:rgba(6,20,30,0.85);display:none;align-items:center;justify-content:center;z-index:300;
    padding:24px;
  }
  .ad-content{
    width:min(700px,98%);border-radius:20px;padding:32px;
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(246,253,255,0.95));
    box-shadow:0 40px 100px rgba(6,20,40,0.6);
    animation: pop .2s ease;
    border:1px solid rgba(255,255,255,0.8);
  }

  .file-upload{
    border:2px dashed rgba(43,182,255,0.4);border-radius:16px;padding:30px;text-align:center;
    transition:all 0.3s ease;cursor:pointer;background:rgba(255,255,255,0.5);
    position:relative;overflow:hidden;
  }
  .file-upload:hover{
    background:rgba(255,255,255,0.7);border-color:rgba(43,182,255,0.8);
    transform:translateY(-2px);box-shadow:0 8px 24px rgba(43,182,255,0.15);
  }
  .file-upload input{display:none}
  .upload-icon{font-size:42px;margin-bottom:12px;color:var(--primary-a)}
  .upload-text{font-weight:700;color:var(--text);font-size:16px;margin-bottom:6px}
  .upload-subtext{font-size:13px;color:var(--muted)}

  .fullscreen-ad{
    position:fixed;inset:0;background:rgba(6,20,30,0.95);display:none;align-items:center;justify-content:center;z-index:400;
    animation: fadeIn 0.5s ease;
    overflow: auto;
    padding: 20px;
  }
  .fullscreen-ad-content{
    width:90%;max-width:420px;border-radius:24px;padding:25px;text-align:center;
    color:white;position:relative;
    animation: scaleIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow:0 20px 60px rgba(0,0,0,0.3);
    max-height: 85vh;
    overflow-y: auto;
  }
  @keyframes scaleIn{
    0%{transform:scale(0.8);opacity:0}
    100%{transform:scale(1);opacity:1}
  }

  .ad-close{
    background:rgba(255,255,255,0.25);border:none;color:white;width:30px;height:30px;
    border-radius:50%;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;
    transition:background 0.3s ease;position:absolute;top:10px;right:10px;
  }
  .ad-close:hover{background:rgba(255,255,255,0.4)}

  .color-picker{
    display:flex;gap:10px;align-items:center;flex-wrap:wrap;
  }
  .color-option{
    width:40px;height:40px;border-radius:10px;cursor:pointer;
    border:3px solid transparent;transition:all 0.3s ease;
  }
  .color-option:hover{
    transform:scale(1.1);border-color:rgba(0,0,0,0.2);
  }
  .color-option.selected{
    border-color:var(--primary-a);transform:scale(1.1);
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
  }

  .modal-backdrop{
    position:fixed;inset:0;background:rgba(6,20,30,0.75);display:none;align-items:center;justify-content:center;z-index:200;
    padding:24px;
  }
  .modal{
    width:min(980px,98%);max-height:92vh;overflow:auto;border-radius:20px;padding:24px;
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(246,253,255,0.95));
    box-shadow:0 40px 100px rgba(6,20,40,0.6);
    animation: pop .2s ease;
    border:1px solid rgba(255,255,255,0.8);
  }
  @keyframes pop{from{transform:translateY(10px) scale(.99);opacity:0}to{transform:none;opacity:1}}

  .smooth-entrance {
    animation: smoothEntrance 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
  }
  @keyframes smoothEntrance {
    0% { opacity: 0; transform: translateY(30px) scale(0.95); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
  }

  .fade-in {
    animation: fadeIn 0.6s ease-out both;
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .ad-video-container {
    width: 100%;
    max-width: 360px;
    height: 640px;
    margin: 0 auto 16px auto;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    background: #000;
  }

  .ad-video-container video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ad-image-container {
    width: 100%;
    max-width: 400px;
    height: 300px;
    margin: 0 auto 16px auto;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  }

  .ad-image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  @media (max-width:860px){
    .hero-left{max-width:100%}
    .post-body img{height:280px}
    .post-body video{height:280px}
    .stories{padding:10px 0}
    .story .avatar{width:68px;height:68px}
    .story{min-width:80px}
    .ad-video-container {
      max-width: 320px;
      height: 560px;
    }
    .ad-image-container {
      max-width: 350px;
      height: 250px;
    }
  }

  @media (max-width:480px){
    .post{padding:14px}
    .post-head img{width:50px;height:50px}
    .post-body img{height:220px}
    .post-body video{height:220px}
    .hero{padding:20px}
    .ad-video-container {
      max-width: 300px;
      height: 520px;
    }
    .ad-image-container {
      max-width: 320px;
      height: 200px;
    }
    .fullscreen-ad-content{
      max-width: 95%;
      padding: 20px;
    }
  }

  .muted{color:var(--muted)}
</style>
</head>
<body>
<div class="welcome-modal" id="welcomeModal">
<div class="welcome-content">
<div class="welcome-tabs">
<button class="welcome-tab active" data-tab="login">–í—Ö–æ–¥</button>
<button class="welcome-tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>
<form class="welcome-form" id="loginForm" style="display:block">
<div class="form-group">
<label for="loginUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
<input id="loginUsername" required="" type="text"/>
</div>
<div class="form-group">
<label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
<input id="loginPassword" required="" type="password"/>
</div>
<button class="btn btn-primary" type="submit">–í–æ–π—Ç–∏</button>
</form>
<form class="welcome-form" id="registerForm" style="display:none">
<div class="form-group">
<label for="registerUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
<input id="registerUsername" required="" type="text"/>
</div>
<div class="form-group">
<label for="registerEmail">Email</label>
<input id="registerEmail" required="" type="email"/>
</div>
<div class="form-group">
<label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
<input id="registerPassword" required="" type="password"/>
</div>
<button class="btn btn-primary" type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
</form>
</div>
</div>

<div class="profile-modal" id="profileModal">
<div class="profile-content">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
<h3 style="margin:0;font-size:22px">–ü—Ä–æ—Ñ–∏–ª—å</h3>
<button class="btn btn-ghost" id="closeProfileBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
<div style="display:flex;flex-direction:column;align-items:center;gap:18px;margin-bottom:28px">
<div style="width:110px;height:110px;border-radius:50%;background:linear-gradient(135deg,var(--primary-a),var(--primary-b));display:flex;align-items:center;justify-content:center;color:white;font-size:42px;font-weight:700;box-shadow:0 8px 24px rgba(43,182,255,0.3)">
<span id="profileInitial"></span>
</div>
<div>
<div id="profileUsername" style="font-weight:800;font-size:20px;text-align:center"></div>
<div id="profileEmail" style="color:var(--muted);text-align:center;margin-top:4px"></div>
</div>
</div>
<div class="form-group">
<label for="profileUsernameInput">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
<input id="profileUsernameInput" type="text"/>
</div>
<div class="form-group">
<label for="profileEmailInput">Email</label>
<input id="profileEmailInput" type="email"/>
</div>
<button class="btn btn-primary" id="saveProfileBtn" style="margin-top:10px">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
</div>
</div>

<div class="create-modal" id="createModal">
<div class="create-content">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
<h3 id="createModalTitle" style="margin:0;font-size:22px">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</h3>
<button class="btn btn-ghost" id="closeCreateBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
<div class="welcome-tabs" id="createTypeTabs" style="margin-bottom:24px">
<button class="welcome-tab active" data-type="post">üìù –ü–æ—Å—Ç</button>
<button class="welcome-tab" data-type="story">üåü –°—Ç–æ—Ä–∏—Å</button>
</div>
<form class="welcome-form" id="createForm">
<div class="form-group">
<label for="createText">–¢–µ–∫—Å—Ç</label>
<textarea id="createText" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?" rows="4" style="padding:16px;border-radius:12px;border:1px solid rgba(9,48,74,0.1);background:rgba(255,255,255,0.8);resize:vertical;font-size:15px;transition:all 0.3s ease"></textarea>
</div>
<div class="form-group">
<label>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ</label>
<div class="file-upload" id="fileUploadArea">
<div class="upload-icon">üìÅ</div>
<div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞</div>
<div class="upload-subtext">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, GIF, MP4 (–¥–æ 500KB)</div>
<input accept="image/*,video/*" id="fileInput" type="file"/>
</div>
</div>
<div id="mediaPreview" style="display:none;margin-bottom:20px">
<div style="border-radius:16px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,0.15)">
<img alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" id="previewImage" src="" style="width:100%;max-height:220px;object-fit:cover;display:none"/>
<video controls="" id="previewVideo" style="width:100%;max-height:220px;display:none;background:#000"></video>
</div>
<div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
<span id="fileName" style="font-size:13px;color:var(--muted);font-weight:500"></span>
<button class="btn btn-ghost" id="removeFileBtn" style="font-size:12px;padding:6px 12px" type="button">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</div>
</div>
<button class="btn btn-primary" id="publishBtn" style="padding:14px;font-size:16px;margin-top:10px" type="submit">üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</form>
</div>
</div>

<div class="ad-modal" id="adModal">
<div class="ad-content">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
<h3 style="margin:0;font-size:22px">üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∫–ª–∞–º—ã</h3>
<button class="btn btn-ghost" id="closeAdBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
<form class="welcome-form" id="adForm">
<div class="form-group">
<label for="adTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ–∫–ª–∞–º—ã</label>
<input id="adTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫" type="text" value="–û–ú–ê–•"/>
</div>
<div class="form-group">
<label for="adText">–¢–µ–∫—Å—Ç —Ä–µ–∫–ª–∞–º—ã</label>
<textarea id="adText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ä–µ–∫–ª–∞–º—ã" rows="3" style="padding:16px;border-radius:12px;border:1px solid rgba(9,48,74,0.1);background:rgba(255,255,255,0.8);resize:vertical;font-size:15px">–ú–ê–• –õ–û–í–ò–¢ –î–ê–ñ–ï –í–û –§–†–ê–ù–¶–ò–ò!</textarea>
</div>
<div class="form-group">
<label for="adButtonText">–¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ</label>
<input id="adButtonText" placeholder="–¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ" type="text" value="–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ"/>
</div>
<div class="form-group">
<label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞ —Ä–µ–∫–ª–∞–º—ã</label>
<div class="color-picker">
<div class="color-option selected" data-color="667eea,764ba2" style="background:linear-gradient(135deg, #667eea, #764ba2)"></div>
<div class="color-option" data-color="ff6b6b,ee5a24" style="background:linear-gradient(135deg, #ff6b6b, #ee5a24)"></div>
<div class="color-option" data-color="4ECDC4,44A08D" style="background:linear-gradient(135deg, #4ECDC4, #44A08D)"></div>
<div class="color-option" data-color="FFD93D,FF9A3D" style="background:linear-gradient(135deg, #FFD93D, #FF9A3D)"></div>
<div class="color-option" data-color="6A11CB,2575FC" style="background:linear-gradient(135deg, #6A11CB, #2575FC)"></div>
</div>
</div>
<div class="form-group">
<label>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –≤–∏–¥–µ–æ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã</label>
<div class="file-upload" id="adFileUploadArea">
<div class="upload-icon">üé¨</div>
<div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞</div>
<div class="upload-subtext">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, GIF, MP4 (–¥–æ 1MB)</div>
<input accept="image/*,video/*" id="adFileInput" type="file"/>
</div>
</div>
<button class="btn btn-primary" id="saveAdBtn" style="padding:14px;font-size:16px;margin-top:10px" type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–ª–∞–º—É</button>
</form>
</div>
</div>

<div class="fullscreen-ad" id="fullscreenAd">
<div class="fullscreen-ad-content" id="fullscreenAdContent">
</div>
</div>

<div id="mainContent" style="display:none">
<div class="wrap">
<header>
<div aria-hidden="true" class="logo">–§</div>
<div>
<h1 style="font-size:22px">–§—Ä–∞–Ω—Ü–∏—Ç–æ</h1>
<p style="font-size:14px">–ù–æ–≤–æ—Å—Ç–∏ –ù–∞–ø–æ–ª–µ–æ–Ω–∞, —Å—Ç–æ—Ä–∏—Å –∏ —é–Ω–∏—Ç–æ–≤</p>
</div>
<div class="sync-controls">
<div class="sync-status" id="syncStatus">üîÑ –ê–≤—Ç–æ—Å–∏–Ω—Ö</div>
<button class="sync-btn" id="manualSyncBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
<button class="sync-btn" id="clearDataBtn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
</div>
<div style="margin-left:auto;display:flex;align-items:center;gap:14px">
<button class="btn btn-primary" id="createPostBtn" style="display:none;align-items:center;gap:8px;padding:10px 16px">
üìù –°–æ–∑–¥–∞—Ç—å
</button>
<button class="btn btn-ghost" id="createAdBtn" style="display:none;align-items:center;gap:8px;padding:10px 16px">
üéØ –†–µ–∫–ª–∞–º–∞
</button>
<button class="btn btn-ghost" id="profileBtn" style="display:flex;align-items:center;gap:10px;padding:8px 14px">
<div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--primary-a),var(--primary-b));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;box-shadow:0 4px 12px rgba(43,182,255,0.3)">
<span id="userInitial"></span>
</div>
<span id="userName" style="font-weight:600"></span>
</button>
<button class="btn btn-ghost" id="logoutBtn" style="font-size:13px;padding:8px 12px">–í—ã–π—Ç–∏</button>
</div>
</header>
<section aria-labelledby="heroTitle" class="hero">
<div class="hero-top">
<div class="hero-left">
<h2 id="heroTitle" style="font-size:32px;background:linear-gradient(90deg,var(--text),var(--muted));-webkit-background-clip:text;-webkit-text-fill-color:transparent">–õ–µ–Ω—Ç–∞ –ù–∞–ø–æ–ª–µ–æ–Ω–∞ ‚Äî —Å–ª–µ–¥–∏ –∑–∞ –∑–∞–≤–æ–µ–≤–∞–Ω–∏—è–º–∏</h2>
<p class="muted" style="font-size:15px;line-height:1.5">–°–º–æ—Ç—Ä–∏ —Å—Ç–æ—Ä–∏—Å, —á–∏—Ç–∞–π –ø–æ—Å—Ç—ã, –æ—Å—Ç–∞–≤–ª—è–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –∑–∞–≥–ª—è–Ω–∏ –≤ ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.</p>
<div class="hero-actions">
<button class="btn btn-ghost" id="openStoryList" style="padding:10px 16px">üé¨ –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å—Ç–æ—Ä–∏—Å</button>
</div>
</div>
<div style="display:flex;flex-direction:column;align-items:flex-end;gap:10px">
<div style="background:linear-gradient(135deg,var(--primary-a),var(--primary-b));padding:12px 18px;border-radius:14px;color:white;font-weight:700;box-shadow:0 8px 24px rgba(43,150,255,0.2);font-size:14px">üéâ –ü—Ä–æ–º–æ: —Å–∫–∏–¥–∫–∞ –Ω–∞ –ù–æ—Ä–º–∞–Ω–¥–∏—é</div>
<div style="font-size:14px;color:var(--muted)">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –§—Ä–∞–Ω—Ü–∏—Ç–æ</div>
</div>
</div>
<div aria-label="–°—Ç–æ—Ä–∏—Å –ù–∞–ø–æ–ª–µ–æ–Ω–∞" class="stories" id="storiesRow">
</div>
</section>
<section>
<div style="display:flex;justify-content:space-between;align-items:end;margin-bottom:8px">
<h2 style="font-size:24px;margin:0">üìÆ –ü–æ—Å—Ç—ã</h2>
<div class="muted" style="font-size:14px">–ß–∏—Ç–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –ù–∞–ø–æ–ª–µ–æ–Ω–∞</div>
</div>
<div aria-live="polite" class="posts" id="postsList">
</div>
</section>
</div>
</div>

<div aria-hidden="true" aria-modal="true" class="modal-backdrop" id="modalBackdrop" role="dialog">
<div class="modal" id="modalContent" role="document">
</div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
function loadAllData() {
  try {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã
    const savedPosts = localStorage.getItem(POSTS_KEY);
    POSTS = savedPosts ? JSON.parse(savedPosts) : getDefaultPosts();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–æ—Ä–∏—Å
    const savedStories = localStorage.getItem(STORIES_KEY);
    STORIES = savedStories ? JSON.parse(savedStories) : getDefaultStories();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    const savedComments = localStorage.getItem(COMMENTS_KEY);
    EXTRA_COMMENTS = savedComments ? JSON.parse(savedComments) : {};
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–∞–π–∫–∏
    const savedLikes = localStorage.getItem(LIKES_KEY);
    LIKES_DATA = savedLikes ? JSON.parse(savedLikes) : {};
    
    updateSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
    resetToDefaultData();
    updateSyncStatus('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
  }
}

function saveAllData() {
  try {
    localStorage.setItem(POSTS_KEY, JSON.stringify(POSTS));
    localStorage.setItem(STORIES_KEY, JSON.stringify(STORIES));
    localStorage.setItem(COMMENTS_KEY, JSON.stringify(EXTRA_COMMENTS));
    localStorage.setItem(LIKES_KEY, JSON.stringify(LIKES_DATA));
    localStorage.setItem(DATA_VERSION_KEY, Date.now().toString());
    
    updateSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
    return true;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
    updateSyncStatus('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
    return false;
  }
}

function getDefaultPosts() {
  return [
    {
      id:'p1',
      author:'–ò–º–ø–µ—Ä–∞—Ç–æ—Ä –ù–∞–ø–æ–ª–µ–æ–Ω',
      avatar:'https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=800&auto=format&fit=crop&s=5b8a6c1bd0d2f94a7c2f1e3b3a1f2c4d',
      time:'–°–µ–≥–æ–¥–Ω—è, 09:12',
      img:'https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1400&auto=format&fit=crop&s=7b0e4b9cb7f0d8cb8155d2d2e3641b35',
      text:'–ù–æ—Ä–º–∞–Ω–¥–∏—è –ø–æ–ª—É—á–µ–Ω–∞. –í–ø–µ—Ä–µ–¥–∏ ‚Äî –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã.',
      likes: 86,
      liked: false
    },
    {
      id:'p2',
      author:'–ò–º–ø–µ—Ä–∞—Ç–æ—Ä –ù–∞–ø–æ–ª–µ–æ–Ω',
      avatar:'https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=800&auto=format&fit=crop&s=5b8a6c1bd0d2f94a7c2f1e3b3a1f2c4d',
      time:'–í—á–µ—Ä–∞, 18:45',
      img:'https://images.unsplash.com/photo-1510751007277-369b4a0b8a31?q=80&w=1400&auto=format&fit=crop&s=4c6a6b1f2c0a4b8a4a5d7d3c2f1d0e0f',
      text:'–ü–∞—Ä–∞–¥ –∑–∞–≤–µ—Ä—à–µ–Ω. –ù–∞—Ä–æ–¥ –≤–æ—Å—Ç–æ—Ä–∂–µ–Ω.',
      likes: 120,
      liked: false
    }
  ];
}

function getDefaultStories() {
  return [
    {id:'s1', name:'–ù–∞–ø–æ–ª–µ–æ–Ω I', img:'https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=1200&auto=format&fit=crop&s=5b8a6c1bd0d2f94a7c2f1e3b3a1f2c4d', caption:'–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ—Ö–æ–¥—É'},
    {id:'s2', name:'–ü–æ–ª–µ –±–∏—Ç–≤—ã', img:'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop&s=2bf4d5d7b3a1f4c4c8b1a1e9e2d3f7a8', caption:'–¢–∞–∫—Ç–∏–∫–∞ –¥–Ω—è'},
    {id:'s3', name:'–ö–∞—Ä—Ç–∞ –ï–≤—Ä–æ–ø—ã', img:'https://images.unsplash.com/photo-1527766833261-b09c3163a791?q=80&w=1200&auto=format&fit=crop&s=8c7a7c8b9d1a2b1c3e4f5a6b7c8d9e0f', caption:'–ó–∞–≤–æ–µ–≤–∞–Ω–∏—è'},
    {id:'s4', name:'–¢—Ä–∏—É–º—Ñ', img:'https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=1200&auto=format&fit=crop&s=6e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b', caption:'–ü–∞—Ä–∞–¥ –ø–æ–±–µ–¥—ã'}
  ];
}

function resetToDefaultData() {
  POSTS = getDefaultPosts();
  STORIES = getDefaultStories();
  EXTRA_COMMENTS = {};
  LIKES_DATA = {};
  saveAllData();
}

function updateSyncStatus(message) {
  const statusElement = document.getElementById('syncStatus');
  if (statusElement) {
    statusElement.textContent = message;
    
    if (message.includes('‚úÖ') || message.includes('üîÑ')) {
      statusElement.classList.remove('syncing');
      setTimeout(() => {
        statusElement.textContent = 'üîÑ –ê–≤—Ç–æ—Å–∏–Ω—Ö';
      }, 3000);
    } else if (message.includes('‚ö†Ô∏è') || message.includes('—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è')) {
      statusElement.classList.add('syncing');
    }
  }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
function startAutoSync() {
  setInterval(() => {
    const lastVersion = localStorage.getItem(DATA_VERSION_KEY);
    const currentVersion = Date.now().toString();
    
    if (lastVersion && parseInt(lastVersion) > parseInt(localStorage.getItem('lastSeenVersion') || '0')) {
      loadAllData();
      renderStories();
      renderPosts();
      updateSyncStatus('üîÑ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
    }
    
    localStorage.setItem('lastSeenVersion', currentVersion);
  }, 5000);
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å—Ç–∞–º–∏ –∏ —Å—Ç–æ—Ä–∏—Å
function deletePost(postId) {
  if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) {
    return;
  }
  
  POSTS = POSTS.filter(post => post.id !== postId);
  delete EXTRA_COMMENTS[postId];
  delete LIKES_DATA[postId];
  
  if (saveAllData()) {
    renderPosts();
    alert('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!');
  } else {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞!');
  }
}

function deleteStory(storyId) {
  if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç–æ—Ä–∏—Å?')) {
    return;
  }
  
  STORIES = STORIES.filter(story => story.id !== storyId);
  
  if (saveAllData()) {
    renderStories();
    alert('–°—Ç–æ—Ä–∏—Å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
  } else {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç–æ—Ä–∏—Å!');
  }
}

const COMMENT_TEMPLATES = [
  "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –∏–º–ø–µ—Ä–∞—Ç–æ—Ä!",
  "–í–µ–ª–∏–∫–æ–µ –∑—Ä–µ–ª–∏—â–µ!",
  "–ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø—Ä–∏–∫–∞–∑—É.",
  "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–ª–∞–Ω–≥–∞.",
  "–ù–∞—Ä–æ–¥ –≤–æ—Å—Ç–æ—Ä–∂–µ–Ω!",
  "–¢–∞–∫—Ç–∏–∫–∞ –±–µ–∑—É–ø—Ä–µ—á–Ω–∞.",
  "–ó–∞–≤–æ–µ–≤–∞–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è!",
  "–§—Ä–∞–Ω—Ü–∏—è –≥–æ—Ä–¥–∏—Ç—Å—è –≤–∞–º–∏!",
  "–°–ª–µ–¥—É—é—â–∞—è —Ü–µ–ª—å - –ê–Ω–≥–ª–∏—è!",
  "–ê—Ä–º–∏—è –≤ –ø–æ–ª–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏."
];

const COMMENT_AUTHORS = [
  "–ú–∞—Ä—à–∞–ª –ñ–∞–Ω", "–û—Ñ–∏—Ü–µ—Ä –õ—é–∫", "–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω –ü—å–µ—Ä", "–ö–æ–º–∞–Ω–¥–∏—Ä –†–µ–Ω", 
  "–ê–Ω–∞–ª–∏—Ç–∏–∫ –ë–µ–Ω", "–°–æ–ª–¥–∞—Ç –ú–∞—Ä–∫", "–ì–µ–Ω–µ—Ä–∞–ª –ö–ª–æ–¥", "–ö–∞–ø–∏—Ç–∞–Ω –ü–æ–ª—å"
];

function generateAutoComments(postText) {
  const commentsCount = Math.floor(Math.random() * 3) + 2;
  const comments = [];
  
  for (let i = 0; i < commentsCount; i++) {
    const randomComment = COMMENT_TEMPLATES[Math.floor(Math.random() * COMMENT_TEMPLATES.length)];
    const randomAuthor = COMMENT_AUTHORS[Math.floor(Math.random() * COMMENT_AUTHORS.length)];
    comments.push({
      name: randomAuthor,
      text: randomComment
    });
  }
  
  return comments;
}

function generateAutoLikes() {
  return Math.floor(Math.random() * 50) + 30;
}

function handleFileSelect(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  if (file.size > 500 * 1024) {
    alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 500KB');
    return;
  }
  
  currentFile = file;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const preview = document.getElementById('mediaPreview');
    const img = document.getElementById('previewImage');
    const video = document.getElementById('previewVideo');
    const fileName = document.getElementById('fileName');
    
    preview.style.display = 'block';
    fileName.textContent = file.name;
    
    if (file.type.startsWith('image/')) {
      img.src = e.target.result;
      img.style.display = 'block';
      video.style.display = 'none';
    } else if (file.type.startsWith('video/')) {
      video.src = e.target.result;
      video.style.display = 'block';
      img.style.display = 'none';
    }
  };
  
  reader.readAsDataURL(file);
}

function removeFile() {
  currentFile = null;
  document.getElementById('mediaPreview').style.display = 'none';
  document.getElementById('fileInput').value = '';
  document.getElementById('previewImage').style.display = 'none';
  document.getElementById('previewVideo').style.display = 'none';
}

function openCreateModal(type = 'post') {
  if (CURRENT_USER.username !== '–ù–∞–ø–æ–ª–µ–æ–Ω') {
    alert('–¢–æ–ª—å–∫–æ –ù–∞–ø–æ–ª–µ–æ–Ω –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã –∏ —Å—Ç–æ—Ä–∏—Å!');
    return;
  }
  
  document.getElementById('createModal').style.display = 'flex';
  document.getElementById('createModalTitle').textContent = type === 'post' ? '–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç' : '–°–æ–∑–¥–∞—Ç—å —Å—Ç–æ—Ä–∏—Å';
  document.getElementById('createForm').reset();
  document.getElementById('mediaPreview').style.display = 'none';
  document.getElementById('previewImage').style.display = 'none';
  document.getElementById('previewVideo').style.display = 'none';
  currentFile = null;
  
  document.querySelectorAll('#createTypeTabs .welcome-tab').forEach(tab => {
    tab.classList.remove('active');
    if (tab.dataset.type === type) {
      tab.classList.add('active');
    }
  });
}

function closeCreateModal() {
  document.getElementById('createModal').style.display = 'none';
}

function publishContent() {
  const text = document.getElementById('createText').value.trim();
  const type = document.querySelector('#createTypeTabs .welcome-tab.active').dataset.type;
  
  if (!text && !currentFile) {
    alert('–î–æ–±–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –º–µ–¥–∏–∞ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏');
    return;
  }
  
  if (CURRENT_USER.username !== '–ù–∞–ø–æ–ª–µ–æ–Ω') {
    alert('–¢–æ–ª—å–∫–æ –ù–∞–ø–æ–ª–µ–æ–Ω –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã –∏ —Å—Ç–æ—Ä–∏—Å!');
    return;
  }
  
  const timestamp = new Date();
  const timeString = timestamp.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
  
  if (type === 'post') {
    const newPost = {
      id: 'p' + Date.now(),
      author: '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä –ù–∞–ø–æ–ª–µ–æ–Ω',
      avatar: 'https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=800&auto=format&fit=crop&s=5b8a6c1bd0d2f94a7c2f1e3b3a1f2c4d',
      time: '–¢–æ–ª—å–∫–æ —á—Ç–æ, ' + timeString,
      text: text,
      likes: generateAutoLikes(),
      liked: false
    };
    
    if (currentFile) {
      const reader = new FileReader();
      reader.onload = function(e) {
        newPost.mediaData = e.target.result;
        newPost.mediaType = currentFile.type;
        POSTS.unshift(newPost);
        
        EXTRA_COMMENTS[newPost.id] = generateAutoComments(text);
        
        if (saveAllData()) {
          closeCreateModal();
          renderStories();
          renderPosts();
          alert('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!');
        }
      };
      reader.readAsDataURL(currentFile);
    } else {
      POSTS.unshift(newPost);
      EXTRA_COMMENTS[newPost.id] = generateAutoComments(text);
      
      if (saveAllData()) {
        closeCreateModal();
        renderStories();
        renderPosts();
        alert('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!');
      }
    }
  } else {
    if (!currentFile) {
      alert('–î–ª—è —Å—Ç–æ—Ä–∏—Å –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!');
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      const newStory = {
        id: 's' + Date.now(),
        name: '–ù–∞–ø–æ–ª–µ–æ–Ω I',
        mediaData: e.target.result,
        caption: text || '–ù–æ–≤–∞—è —Å—Ç–æ—Ä–∏—Å –æ—Ç –ù–∞–ø–æ–ª–µ–æ–Ω–∞'
      };
      
      STORIES.unshift(newStory);
      
      if (saveAllData()) {
        closeCreateModal();
        renderStories();
        renderPosts();
        alert('–°—Ç–æ—Ä–∏—Å —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞!');
      }
    };
    reader.readAsDataURL(currentFile);
  }
}

function renderStories() {
  const storiesRow = document.getElementById('storiesRow');
  storiesRow.innerHTML = '';
  
  STORIES.forEach((s, index) => {
    const el = document.createElement('div');
    el.className = 'story';
    el.style.opacity = '0';
    el.style.transform = 'translateY(20px)';
    
    const imageUrl = s.mediaData || s.img;
    const isNapoleon = CURRENT_USER.username === '–ù–∞–ø–æ–ª–µ–æ–Ω';
    const deleteButton = isNapoleon ? `<button class="delete-btn" data-delete-story="${s.id}">√ó</button>` : '';
    
    el.innerHTML = `
      <div class="avatar" role="button" tabindex="0" data-id="${s.id}">
        <img src="${imageUrl}" alt="${escapeHtml(s.name)}" onerror="this.src='https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=1200&auto=format&fit=crop&s=5b8a6c1bd0d2f94a7c2f1e3b3a1f2c4d'">
        ${deleteButton}
      </div>
      <small>${escapeHtml(s.name)}</small>
    `;
    
    el.querySelector('.avatar').addEventListener('click', (e) => {
      if (!e.target.classList.contains('delete-btn')) {
        openStoryViewer(s);
      }
    });
    
    if (isNapoleon) {
      el.querySelector(`[data-delete-story="${s.id}"]`).addEventListener('click', (e) => {
        e.stopPropagation();
        deleteStory(s.id);
      });
    }
    
    storiesRow.appendChild(el);
    
    setTimeout(() => {
      el.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    }, 100 * index);
  });
}

function renderPosts() {
  const postsList = document.getElementById('postsList');
  postsList.innerHTML = '';
  
  POSTS.forEach((p, index) => {
    const el = document.createElement('article');
    el.className = 'post';
    el.style.opacity = '0';
    el.style.transform = 'translateY(20px)';
    
    const isLiked = LIKES_DATA[p.id] || false;
    if (isLiked) {
      p.liked = true;
    }
    
    const extra = EXTRA_COMMENTS[p.id] || [];
    const mergedComments = [...(p.comments || []), ...extra];
    
    let mediaContent = '';
    if (p.mediaData) {
      if (p.mediaType && p.mediaType.startsWith('video/')) {
        mediaContent = `<video controls style="width:100%;height:380px;border-radius:16px;background:#000">
          <source src="${p.mediaData}" type="${p.mediaType}">
         </video>`;
      } else {
        mediaContent = `<div class="media-container"><img src="${p.mediaData}" alt="–ü–æ—Å—Ç ${escapeHtml(p.id)}" loading="lazy"></div>`;
      }
    } else if (p.video) {
      mediaContent = `<video controls style="width:100%;height:380px;border-radius:16px;background:#000">
        <source src="${p.video}" type="video/mp4">
       </video>`;
    } else if (p.img) {
      mediaContent = `<div class="media-container"><img src="${p.img}" alt="–ü–æ—Å—Ç ${escapeHtml(p.id)}" loading="lazy"></div>`;
    }
    
    const isNapoleon = CURRENT_USER.username === '–ù–∞–ø–æ–ª–µon';
    const deleteButton = isNapoleon ? `<button class="delete-post-btn" data-delete-post="${p.id}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>` : '';
    
    el.innerHTML = `
      <div class="post-head">
        <img src="${p.avatar}" alt="${escapeHtml(p.author)}">
        <div class="meta">
          <div class="author">${escapeHtml(p.author)}</div>
          <div class="time">${escapeHtml(p.time)}</div>
        </div>
      </div>
      <div class="post-body">
        ${p.text ? `<div class="text-content">${escapeHtml(p.text)}</div>` : ''}
        ${mediaContent}
      </div>
      <div class="post-actions" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
        <button class="like-btn ${isLiked ? 'liked' : ''}" data-like="${p.id}">
          ${isLiked ? '‚ù§Ô∏è' : 'ü§ç'} <span class="likes-count">${p.likes}</span>
        </button>
        <button class="comment-btn" data-open-comments="${p.id}">
          üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${mergedComments.length})
        </button>
        ${deleteButton}
      </div>
      <div class="comments" id="comments-${p.id}" style="display:none">
        ${mergedComments.map(c=>commentHtml(c)).join('')}
        <div class="add-comment">
          <input placeholder="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." aria-label="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" id="input-${p.id}">
          <button data-add="${p.id}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    `;

    el.querySelector('[data-like]').addEventListener('click', (e)=>{
      const btn = e.currentTarget;
      const wasLiked = p.liked;
      
      if (!wasLiked) {
        p.likes += 1;
        p.liked = true;
        btn.classList.add('liked');
        btn.innerHTML = `‚ù§Ô∏è <span class="likes-count">${p.likes}</span>`;
        LIKES_DATA[p.id] = true;
      } else {
        p.likes -= 1;
        p.liked = false;
        btn.classList.remove('liked');
        btn.innerHTML = `ü§ç <span class="likes-count">${p.likes}</span>`;
        LIKES_DATA[p.id] = false;
      }
      
      saveAllData();
      
      btn.animate([
        { transform: 'scale(1)' },
        { transform: 'scale(1.3)' },
        { transform: 'scale(1)' }
      ], { duration: 400 });
    });

    el.querySelector('[data-open-comments]').addEventListener('click', (e)=>{
      const area = el.querySelector(`#comments-${p.id}`);
      area.style.display = area.style.display === 'none' ? 'flex' : 'none';
    });

    el.querySelector(`[data-add="${p.id}"]`).addEventListener('click', ()=>{
      const input = el.querySelector(`#input-${p.id}`);
      const text = input.value.trim();
      if(!text) return input.focus();
      
      const newComment = {name:CURRENT_USER.username, text};
      EXTRA_COMMENTS[p.id] = EXTRA_COMMENTS[p.id] || [];
      EXTRA_COMMENTS[p.id].push(newComment);
      saveAllData();
      
      input.value = '';
      renderPosts();
    });

    if (isNapoleon) {
      el.querySelector(`[data-delete-post="${p.id}"]`).addEventListener('click', ()=>{
        deletePost(p.id);
      });
    }

    postsList.appendChild(el);
    
    setTimeout(() => {
      el.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    }, 150 * index + 200);
  });
}

function commentHtml(c){
  const avatar = `<div class="c-avatar">${escapeHtml((c.name||'U')[0])}</div>`;
  return `
    <div class="comment">
      ${avatar}
      <div class="c-body">
        <div class="name">${escapeHtml(c.name || '–ê–Ω–æ–Ω–∏–º')}</div>
        <div class="text">${escapeHtml(c.text)}</div>
      </div>
    </div>
  `;
}

function openStoryViewer(s){
  const imageUrl = s.mediaData || s.img;
  
  const html = `
    <div style="display:flex;flex-direction:column;gap:16px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;gap:12px;align-items:center">
          <img src="${imageUrl}" alt="${escapeHtml(s.name)}" style="width:60px;height:60px;border-radius:12px;object-fit:cover;box-shadow:0 4px 12px rgba(0,0,0,0.15)">
          <div>
            <div style="font-weight:700;font-size:16px">${escapeHtml(s.name)}</div>
            <div style="font-size:14px;color:${getMuted()};">–°—Ç–æ—Ä–∏—Å</div>
          </div>
        </div>
        <button data-close class="btn btn-ghost" style="padding:10px 16px">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div style="border-radius:16px;overflow:hidden;box-shadow:0 12px 32px rgba(0,0,0,0.2)">
        <img src="${imageUrl}" alt="${escapeHtml(s.caption)}" style="width:100%;height:520px;object-fit:cover;display:block">
      </div>
      <div style="color:${getMuted()};font-size:15px;padding:0 8px">${escapeHtml(s.caption)}</div>
    </div>
  `;
  openModal(html);
  modalContent.querySelector('[data-close]').addEventListener('click', closeModal);
}

function openModal(html){
  const modalContent = document.getElementById('modalContent');
  modalContent.innerHTML = html;
  const modalBackdrop = document.getElementById('modalBackdrop');
  modalBackdrop.style.display = 'flex';
  modalBackdrop.setAttribute('aria-hidden','false');
  const closeBtn = modalContent.querySelector('[data-close]');
  if(closeBtn) closeBtn.focus();
}

function closeModal(){
  const modalBackdrop = document.getElementById('modalBackdrop');
  modalBackdrop.style.display = 'none';
  modalBackdrop.setAttribute('aria-hidden','true');
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã
function openAdModal() {
  if (CURRENT_USER.username !== '–ù–∞–ø–æ–ª–µ–æ–Ω') {
    alert('–¢–æ–ª—å–∫–æ –ù–∞–ø–æ–ª–µ–æ–Ω –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ä–µ–∫–ª–∞–º—É!');
    return;
  }
  
  document.getElementById('adModal').style.display = 'flex';
  
  const adData = JSON.parse(localStorage.getItem(AD_KEY));
  if (adData) {
    document.getElementById('adTitle').value = adData.title || '–û–ú–ê–•';
    document.getElementById('adText').value = adData.text || '–ú–ê–• –õ–û–í–ò–¢ –î–ê–ñ–ï –í–û –§–†–ê–ù–¶–ò–ò!';
    document.getElementById('adButtonText').value = adData.buttonText || '–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ';
    selectedAdColor = adData.color || '667eea,764ba2';
    
    document.querySelectorAll('.color-option').forEach(option => {
      option.classList.remove('selected');
      if (option.dataset.color === selectedAdColor) {
        option.classList.add('selected');
      }
    });
  }
  
  document.getElementById('adFileInput').value = '';
  currentAdFile = null;
}

function closeAdModal() {
  document.getElementById('adModal').style.display = 'none';
  currentAdFile = null;
}

function handleAdFileSelect(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  if (file.size > 1 * 1024 * 1024) {
    alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 1 –ú–ë');
    return;
  }
  
  currentAdFile = file;
  alert(`–§–∞–π–ª "${file.name}" —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω –¥–ª—è —Ä–µ–∫–ª–∞–º—ã`);
}

function saveAd() {
  const title = document.getElementById('adTitle').value.trim();
  const text = document.getElementById('adText').value.trim();
  const buttonText = document.getElementById('adButtonText').value.trim();
  
  if (!title || !text || !buttonText) {
    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è —Ä–µ–∫–ª–∞–º—ã!');
    return;
  }
  
  const adData = {
    title,
    text,
    buttonText,
    color: selectedAdColor,
    timestamp: new Date().toISOString()
  };
  
  if (currentAdFile) {
    const reader = new FileReader();
    reader.onload = function(e) {
      adData.media = e.target.result;
      adData.mediaType = currentAdFile.type;
      localStorage.setItem(AD_KEY, JSON.stringify(adData));
      closeAdModal();
      alert('–†–µ–∫–ª–∞–º–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
    };
    reader.readAsDataURL(currentAdFile);
  } else {
    const existingAd = JSON.parse(localStorage.getItem(AD_KEY));
    if (existingAd && existingAd.media) {
      adData.media = existingAd.media;
      adData.mediaType = existingAd.mediaType;
    }
    localStorage.setItem(AD_KEY, JSON.stringify(adData));
    closeAdModal();
    alert('–†–µ–∫–ª–∞–º–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
  }
}

function showAdOnce() {
  const adShown = localStorage.getItem(AD_SHOWN_KEY);
  if (adShown) {
    return;
  }
  
  const adData = JSON.parse(localStorage.getItem(AD_KEY));
  if (!adData) {
    return;
  }
  
  localStorage.setItem(AD_SHOWN_KEY, 'true');
  setTimeout(showFullscreenAd, 3000);
}

function showFullscreenAd() {
  const adData = JSON.parse(localStorage.getItem(AD_KEY));
  if (!adData) return;
  
  const colors = adData.color.split(',');
  const gradient = `linear-gradient(135deg, #${colors[0]}, #${colors[1]})`;
  
  const adContent = document.getElementById('fullscreenAdContent');
  adContent.style.background = gradient;
  
  let mediaContent = '';
  if (adData.media) {
    if (adData.mediaType && adData.mediaType.startsWith('video/')) {
      mediaContent = `
        <div class="ad-video-container">
          <video src="${adData.media}" controls autoplay muted style="width:100%;height:100%;object-fit:cover"></video>
        </div>
      `;
    } else {
      mediaContent = `
        <div class="ad-image-container">
          <img src="${adData.media}" alt="–†–µ–∫–ª–∞–º–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="width:100%;height:100%;object-fit:cover">
        </div>
      `;
    }
  } else {
    mediaContent = `
      <div style="width:100%;max-width:360px;height:200px;margin:0 auto 16px auto;border-radius:16px;display:flex;align-items:center;justify-content:center;color:white;font-size:16px;font-weight:700;background:rgba(255,255,255,0.2)">
        –†–µ–∫–ª–∞–º–Ω–æ–µ –º–µ—Å—Ç–æ
      </div>
    `;
  }
  
  adContent.innerHTML = `
    <button class="ad-close" id="closeFullscreenAd">√ó</button>
    <h2 style="margin:0 0 12px 0;color:white;font-size:24px;font-weight:800;line-height:1.2">${escapeHtml(adData.title)}</h2>
    <p style="margin:0 0 15px 0;font-size:18px;font-weight:700;line-height:1.3">${escapeHtml(adData.text)}</p>
    ${mediaContent}
    <button class="btn" id="fullscreenAdButton" style="background:white;color:#${colors[0]};font-weight:700;padding:12px 24px;font-size:14px;margin-top:10px;border-radius:12px">${escapeHtml(adData.buttonText)}</button>
  `;
  
  document.getElementById('fullscreenAd').style.display = 'flex';
  
  document.getElementById('closeFullscreenAd').addEventListener('click', closeFullscreenAd);
  document.getElementById('fullscreenAdButton').addEventListener('click', () => {
    alert('–ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Ä–µ–∫–ª–∞–º–µ...');
    closeFullscreenAd();
  });
}

function closeFullscreenAd() {
  document.getElementById('fullscreenAd').style.display = 'none';
}

// –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
function openProfileModal() {
  document.getElementById('profileModal').style.display = 'flex';
  document.getElementById('profileUsername').textContent = CURRENT_USER.username;
  document.getElementById('profileEmail').textContent = CURRENT_USER.email;
  document.getElementById('profileInitial').textContent = CURRENT_USER.username.charAt(0).toUpperCase();
  document.getElementById('profileUsernameInput').value = CURRENT_USER.username;
  document.getElementById('profileEmailInput').value = CURRENT_USER.email;
}

function closeProfileModal() {
  document.getElementById('profileModal').style.display = 'none';
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function getMuted(){ return 'rgba(88,115,136,0.9)'; }

// –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
function checkAuth() {
  try {
    const authData = localStorage.getItem(AUTH_KEY);
    if (authData) {
      CURRENT_USER = JSON.parse(authData);
      initializeApp();
    } else {
      showWelcomeModal();
    }
  } catch (e) {
    showWelcomeModal();
  }
}

function showWelcomeModal() {
  document.getElementById('welcomeModal').style.display = 'flex';
  document.getElementById('mainContent').style.display = 'none';
}

function showMainContent() {
  document.getElementById('welcomeModal').style.display = 'none';
  document.getElementById('mainContent').style.display = 'block';
  
  const mainContent = document.getElementById('mainContent');
  mainContent.style.opacity = '0';
  mainContent.classList.add('smooth-entrance');
}

function initializeApp() {
  loadAllData();
  showMainContent();
  
  document.getElementById('userName').textContent = CURRENT_USER.username;
  document.getElementById('userInitial').textContent = CURRENT_USER.username.charAt(0).toUpperCase();
  
  const isNapoleon = CURRENT_USER.username === '–ù–∞–ø–æ–ª–µ–æ–Ω';
  document.getElementById('createPostBtn').style.display = isNapoleon ? 'flex' : 'none';
  document.getElementById('createAdBtn').style.display = isNapoleon ? 'flex' : 'none';
  
  renderStories();
  renderPosts();
  startAutoSync();
  showAdOnce();
  
  document.querySelectorAll('.post, .story').forEach((el, i) => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(20px)';
    setTimeout(() => {
      el.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    }, 100 * i);
  });
}

function login(username, password) {
  if (username === '–ù–∞–ø–æ–ª–µ–æ–Ω' && password === '–∞–¥–º–∏–Ω1') {
    CURRENT_USER = {...NAPOLEON_ACCOUNT};
    localStorage.setItem(AUTH_KEY, JSON.stringify(CURRENT_USER));
    initializeApp();
    return true;
  }
  
  const users = JSON.parse(localStorage.getItem(USERS_KEY) || '{}');
  if (users[username] && users[username].password === password) {
    CURRENT_USER = users[username];
    localStorage.setItem(AUTH_KEY, JSON.stringify(CURRENT_USER));
    initializeApp();
    return true;
  }
  return false;
}

function register(username, email, password) {
  const users = JSON.parse(localStorage.getItem(USERS_KEY) || '{}');
  if (users[username]) {
    return false;
  }
  
  const newUser = {
    username,
    email,
    password,
    joined: new Date().toISOString()
  };
  
  users[username] = newUser;
  localStorage.setItem(USERS_KEY, JSON.stringify(users));
  
  CURRENT_USER = newUser;
  localStorage.setItem(AUTH_KEY, JSON.stringify(CURRENT_USER));
  initializeApp();
  return true;
}

function logout() {
  CURRENT_USER = null;
  localStorage.removeItem(AUTH_KEY);
  localStorage.removeItem(AD_SHOWN_KEY);
  showWelcomeModal();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.welcome-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.welcome-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('registerForm').style.display = 'none';
      
      if (tab.dataset.tab === 'login') {
        document.getElementById('loginForm').style.display = 'block';
      } else {
        document.getElementById('registerForm').style.display = 'block';
      }
    });
  });

  document.querySelectorAll('#createTypeTabs .welcome-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('#createTypeTabs .welcome-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('createModalTitle').textContent = tab.dataset.type === 'post' ? '–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç' : '–°–æ–∑–¥–∞—Ç—å —Å—Ç–æ—Ä–∏—Å';
    });
  });

  document.querySelectorAll('.color-option').forEach(option => {
    option.addEventListener('click', () => {
      document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
      option.classList.add('selected');
      selectedAdColor = option.dataset.color;
    });
  });

  document.getElementById('fileUploadArea').addEventListener('click', () => {
    document.getElementById('fileInput').click();
  });
  
  document.getElementById('fileInput').addEventListener('change', handleFileSelect);
  document.getElementById('removeFileBtn').addEventListener('click', removeFile);

  document.getElementById('adFileUploadArea').addEventListener('click', () => {
    document.getElementById('adFileInput').click();
  });
  
  document.getElementById('adFileInput').addEventListener('change', handleAdFileSelect);

  document.getElementById('loginForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    
    if (!login(username, password)) {
      alert('–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
    }
  });

  document.getElementById('registerForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const username = document.getElementById('registerUsername').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    if (!register(username, email, password)) {
      alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
    }
  });

  document.getElementById('createPostBtn').addEventListener('click', () => {
    openCreateModal('post');
  });

  document.getElementById('createAdBtn').addEventListener('click', openAdModal);

  document.getElementById('createForm').addEventListener('submit', (e) => {
    e.preventDefault();
    publishContent();
  });

  document.getElementById('adForm').addEventListener('submit', (e) => {
    e.preventDefault();
    saveAd();
  });

  document.getElementById('profileBtn').addEventListener('click', openProfileModal);

  document.getElementById('closeCreateBtn').addEventListener('click', closeCreateModal);
  document.getElementById('closeProfileBtn').addEventListener('click', closeProfileModal);
  document.getElementById('closeAdBtn').addEventListener('click', closeAdModal);

  document.getElementById('logoutBtn').addEventListener('click', logout);

  document.getElementById('openStoryList').addEventListener('click', ()=> openStoryViewer(STORIES[0]));

  document.getElementById('manualSyncBtn').addEventListener('click', function() {
    updateSyncStatus('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...');
    loadAllData();
    renderStories();
    renderPosts();
    updateSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
  });

  document.getElementById('clearDataBtn').addEventListener('click', function() {
    if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
      resetToDefaultData();
      renderStories();
      renderPosts();
      updateSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã');
    }
  });


  const modalBackdrop = document.getElementById('modalBackdrop');
  modalBackdrop.addEventListener('click', (e)=>{
    if(e.target === modalBackdrop) closeModal();
  });

  window.addEventListener('keydown', (e)=>{ 
    if(e.key === 'Escape') {
      closeModal();
      closeCreateModal();
      closeProfileModal();
      closeAdModal();
      closeFullscreenAd();
    }
  });
});

checkAuth();
</script>
</body>
</html>